<div>信用贷款管理</div><div><br /></div><div>简介</div><div><br /></div><div>该智能合约实现一个简单的担保融资流程：</div><div><br /></div><div>核心企业为融资企业向区块链平台提交融资申请。</div><div>初始化核心企业，初始化融资企业。</div><div>平台为融资企业，针对不同银行发行一定量数字货币。</div><div>融资企业向核心企业转移一定量数字货币来担保获得贷款。</div><div>融资企业归还贷款后，核心企业归还货币给融资企业用于下一次贷款。</div><div><br /></div><div>函数说明：</div><div><ul><li>init：<span class="Apple-tab-span" style="white-space: pre;">	</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;初始化区</li><li>invoke： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 调用合约内部的函数；</li><li>query：<span class="Apple-tab-span" style="white-space: pre;">	</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;查询相关的信息；</li><li>createFinancing： &nbsp; &nbsp; &nbsp;融资申请</li><li>createCompany： &nbsp; &nbsp; &nbsp;新增企业（核心企业，融资企业）</li><li>createCoinToCoreCp：平台向融资企业打入代币</li><li>transferCoin： &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 核心企业和融资企业之间转移代币</li><li>getCompanyById： &nbsp; 获取企业信息；</li><li>getTransactionById：获取某笔交易记录；</li><li>writeCompany： &nbsp; &nbsp; &nbsp; &nbsp;修改企业信息；</li><li>writeTransaction： &nbsp; &nbsp; 写入交易信息。</li></ul></div><div><br /></div><div>数据结构设计：</div><div>// 融资申请</div><div>type Financing struct {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CoreCompanyID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string // 核心企业ID</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FinanceCompanyID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string &nbsp; &nbsp; &nbsp;// 融资企业ID</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BankID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string &nbsp; &nbsp; &nbsp;// 银行ID</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Amount &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; // 融资金额</div><div>}</div><div><br /></div><div>// 企业</div><div>type Company struct {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CompanyID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp; // 企业ID</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;// 0: 核心企业, 1:贷款企业</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Amount map[string] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// map类型，不同银行对应不同的代币 &nbsp;key是银行ID，value是代币数</div><div>}</div><div><br /></div><div>// 交易</div><div>type Transaction struct {</div><div>&nbsp; &nbsp; &nbsp; &nbsp; FromID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp;// 转出方企业ID</div><div>&nbsp; &nbsp; &nbsp; &nbsp; ToID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp;// 转入方企业ID</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int64 &nbsp; &nbsp; // 交易时间</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Amount &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int &nbsp; &nbsp; &nbsp; &nbsp; // 交易金额</div><div>&nbsp; &nbsp; &nbsp; &nbsp; Note &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp;//备注</div><div>&nbsp; &nbsp; &nbsp; &nbsp;ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int &nbsp; &nbsp; &nbsp; &nbsp;// 交易ID</div><div>}</div><div><br /></div><div>简要流程（命令行）</div><div><br /></div><div>1. 用户登录，使用内置用户jim登录，密码6avZQLwcUe9b</div><div>docker exec -it pbft_vp0_1 bash</div><div>peer network login jim</div><div><br /></div><div>2. 在区块链上初始化部署智能合约</div><div>// deploy会生成chaincode id，记上这个ID，后面的query和invoke都需要用到</div><div>peer chaincode deploy -u jim -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example_financing -c '{"Function":"init", "Args": ["This is a block chain test"]}'</div><div>Deploy chaincode: b2b303da6807f95f93706144529abb7bac389319e43a3b15750c36c72d5c5bae7e0468b6de4f645c1583fdaaf4b1eba8907846204cb78beb0217b9ab08312114</div><div><br /></div><div>3. 核心企业向区块链写入贷款申请，带参数：核心企业ID, 贷款企业ID,银行ID，贷款金额</div><div>peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "createFinancing", "Args": ["HXQY001", "DKQY001", "CCB", "1000000"]}'</div><div><br /></div><div>4. &nbsp;区块链平台根据核心企业的申请，a. 创建或更新核心企业，b. 创建或更新贷款企业，c. 为核心企业生成对应数量代币（不同银行使用不同代币）</div><div>// 创建或更新核心企业，带参数： 核心企业ID, 企业类型（0：核心企业,1:贷款企业），银行ID，贷款金额（初始化为0）</div><div>peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "createCompany", "Args": ["HXQY001", "0", "CCB", "0"]}'</div><div>// 创建或更新贷款企业，带参数： 贷款企业ID, 企业类型，银行ID，贷款金额（初始化为0）</div><div>peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "createCompany", "Args": ["DKQY001", "1", "CCB", "0"]}'</div><div>// 平台为贷款企业分配代币，参数：贷款企业ID， 银行ID，贷款金额</div><div>peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "createCoinToCoreCp", "Args": ["DKQY001","CCB", "1000000"]}'</div><div><br /></div><div>5. 贷款企业发起融资申请，向区块链写贷款用途、贷款额度、还款时限、贷款银行”等信息，然后将对应贷款额度的授信代币发送至核心企业。(写入交易记录)</div><div>参数：发送方企业ID， 接收方企业ID， 银行ID，额度，备注</div><div>peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "transferCoin", "Args": ["DKQY001","HXQY001", "CCB", "800000", "Test1234"]}'</div><div><br /></div><div>6. 贷款企业归还贷款，核心企业归还代向给贷款企业(写入交易记录)</div><div>参数：发送方企业ID， 接收方企业ID， 银行ID，额度,备注</div><div>peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "transferCoin", "Args": ["HXQY001","DKQY001", "CCB", "800000"，"Test1234"]}'</div><div><br /></div><div>7. 查询接口：查询企业，查询申请，查询交易等等</div><div>peer chaincode query -u jim -n $(chaincode id) -c '{"Function": "getCompanyById", "Args": ["HXQY001"]}'</div><div><br /></div><div>流程（图形界面）</div><div>ＴＯＤＯ：　目前界面和智能合约还在联调中，后续再补充。</div><div><br /></div><div>备注：</div><div>个人觉得智能合约业务逻辑单纯一些比较好，比如企业ＩＤ唯一性的判断，金额大小的比较，不同银行对应不同代币的数据结构等，以及一些信息的备份等。都没必要放到智能合约中处理，而应该在区块链应用中就做好处理／存储。</div>

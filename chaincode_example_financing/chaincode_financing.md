<div><span style="color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px;">信用贷款管理</span></div><div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; margin-top: 0px !important;"><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">简介</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">该智能合约实现一个简单的担保融资流程：</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">核心企业为融资企业向区块链平台提交融资申请。</div><div style="box-sizing: border-box;">初始化核心企业，初始化融资企业。</div><div style="box-sizing: border-box;">平台为融资企业，针对不同银行发行一定量数字货币。</div><div style="box-sizing: border-box;">融资企业向核心企业转移一定量数字货币来担保获得贷款。</div><div style="box-sizing: border-box;">融资企业归还贷款后，核心企业归还货币给融资企业用于下一次贷款。</div><div style="box-sizing: border-box;"><br /></div><div style="box-sizing: border-box;">数据结构设计</div><div style="box-sizing: border-box;">// 融资申请</div><div style="box-sizing: border-box;">type Financing struct {</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; CoreCompanyID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string // 核心企业ID</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; FinanceCompanyID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string &nbsp; &nbsp; &nbsp;// 融资企业ID</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; BankID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string &nbsp; &nbsp; &nbsp;// 银行ID</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Amount &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp;&nbsp;// 融资金额</div><div style="box-sizing: border-box;">}</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">// 企业</div><div style="box-sizing: border-box;">type Company struct {</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CompanyID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp; // 企业ID</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; Type &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;// 0: 核心企业, 1:贷款企业</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; Amount map[string] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // map类型，不同银行对应不同的代币 &nbsp;key是银行ID，value是代币数</div><div style="box-sizing: border-box;">}</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">// 交易</div><div style="box-sizing: border-box;">type Transaction struct {</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; FromID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string // 转出方企业ID</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; ToID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string // 转入方企业ID</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; Time &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int64 &nbsp; &nbsp; &nbsp; &nbsp;// 交易时间</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; Amount &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int &nbsp; &nbsp; &nbsp; &nbsp;// 交易金额</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp; Note &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string &nbsp; &nbsp; &nbsp;//备注</div><div style="box-sizing: border-box;">&nbsp; &nbsp; &nbsp; &nbsp;ID &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int &nbsp; &nbsp; &nbsp; &nbsp;// 交易ID</div><div style="box-sizing: border-box;">}</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">简要流程（命令行）</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;"><div style="box-sizing: border-box;">1. 用户登录，使用内置用户jim登录，密码6avZQLwcUe9b</div><div style="box-sizing: border-box;">docker exec -it pbft_vp0_1 bash</div><div style="box-sizing: border-box;">peer network login jim</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">2. 在区块链上初始化部署智能合约</div><div style="box-sizing: border-box;">// deploy会生成chaincode id，记上这个ID，后面的query和invoke都需要用到</div><div style="box-sizing: border-box;">peer chaincode deploy -u jim -p github.com/hyperledger/fabric/examples/chaincode/go/chaincode_example_financing -c '{"Function":"init", "Args": ["This is a block chain test"]}'</div><div style="box-sizing: border-box;">Deploy chaincode: b2b303da6807f95f93706144529abb7bac389319e43a3b15750c36c72d5c5bae7e0468b6de4f645c1583fdaaf4b1eba8907846204cb78beb0217b9ab08312114</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">3. 核心企业向区块链写入贷款申请，带参数：核心企业ID, 贷款企业ID,银行ID，贷款金额</div><div style="box-sizing: border-box;">peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "createFinancing", "Args": ["HXQY001", "DKQY001", "CCB", "1000000"]}'</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">4. &nbsp;区块链平台根据核心企业的申请，a. 创建或更新核心企业，b. 创建或更新贷款企业，c. 为核心企业生成对应数量代币（不同银行使用不同代币）</div><div style="box-sizing: border-box;">// 创建或更新核心企业，带参数： 核心企业ID, 企业类型（0：核心企业,1:贷款企业），银行ID，贷款金额（初始化为0）</div><div style="box-sizing: border-box;">peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "createCompany", "Args": ["HXQY001", "0", "CCB", "0"]}'</div><div style="box-sizing: border-box;">// 创建或更新贷款企业，带参数： 贷款企业ID, 企业类型，银行ID，贷款金额（初始化为0）</div><div style="box-sizing: border-box;">peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "createCompany", "Args": ["DKQY001", "1", "CCB", "0"]}'</div><div style="box-sizing: border-box;">// 平台为贷款企业分配代币，参数：贷款企业ID， 银行ID，贷款金额</div><div style="box-sizing: border-box;">peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "createCoinToCoreCp", "Args": ["DKQY001","CCB", "1000000"]}'</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">5. 贷款企业发起融资申请，向区块链写贷款用途、贷款额度、还款时限、贷款银行”等信息，然后将对应贷款额度的授信代币发送至核心企业。(写入交易记录)</div><div style="box-sizing: border-box;">参数：发送方企业ID， 接收方企业ID， 银行ID，额度，备注</div><div style="box-sizing: border-box;">peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "transferCoin", "Args": ["DKQY001","HXQY001", "CCB", "800000", "Test1234"]}'</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">6. 贷款企业归还贷款，核心企业归还代向给贷款企业(写入交易记录)</div><div style="box-sizing: border-box;">参数：发送方企业ID， 接收方企业ID， 银行ID，额度,备注</div><div style="box-sizing: border-box;">peer chaincode invoke -u jim -n $(chaincode id) -c '{"Function": "transferCoin", "Args": ["HXQY001","DKQY001", "CCB", "800000"，"Test1234"]}'</div><div style="box-sizing: border-box;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box;">7. 查询接口：查询企业，查询申请，查询交易等等</div><div style="box-sizing: border-box;">peer chaincode query -u jim -n $(chaincode id) -c '{"Function": "getCompanyById", "Args": ["HXQY001"]}'</div></div></div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px;">流程（图形界面）</div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px;">ＴＯＤＯ：　目前界面和智能合约还在联调中，后续再补充。</div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px;"><br style="box-sizing: border-box;" /></div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px;">备注：</div><div style="box-sizing: border-box; color: rgb(51, 51, 51); font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Helvetica, Arial, sans-serif, &quot;Apple Color Emoji&quot;, &quot;Segoe UI Emoji&quot;, &quot;Segoe UI Symbol&quot;; font-size: 16px; margin-bottom: 0px !important;">个人觉得智能合约业务逻辑单纯一些比较好，比如企业ＩＤ唯一性的判断，金额大小的比较，不同银行对应不同代币的数据结构等，以及一些信息的备份等。都没必要放到智能合约中处理，而应该在区块链应用中就做好处理／存储。</div></div>
